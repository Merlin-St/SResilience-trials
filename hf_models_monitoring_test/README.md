# Quick test of a dashboard for HuggingFace data
# AI Sector Analysis for Societal Resilience

## Project Goal

This 1-day quick trial aims to show what post-deployment monitoring of Frontier AI could mean, by analyzing the landscape of AI models on HuggingFace, particularly focusing on their relevance to different economic sectors defined by NAICS codes and US Critical National Infrastructure classifications (CNI). 
Closed-source Frontier AI models are not on HuggingFace, thus this is rather a tractable quick trial on the open-source landscape than a priority project.

## Folder Structure & File Descriptions

Here's a breakdown of the files within this project folder:

**Core Scripts:**

* **`Industry_mapping_spheres_CNI.py`**:
    * Loads official NAICS code descriptions (`2-6 digit_2022_Codes.xlsx`).
    * Uses an LLM (via `model_completions.py`) to classify 4-digit NAICS subsectors based on their relevance to the 16 US CNI sectors.
    * Calculates the percentage of CNI-related subsectors within each 2-digit NAICS sector.
    * Extracts relevant keywords from NAICS titles for each 2-digit sector.
    * Outputs: `naics_cni_classification_raw.csv`, `naics_cni_classification_complete.csv`, `naics_cni_percentages.csv`, `naics_cni_percentages.png`.
* **`run_data_collection.py`**:
    * Orchestrates the collection of AI model data from the Hugging Face Hub.
    * Uses `config_utils.py` for settings, `data_processing.py` to load keywords/CNI info from `naics_cni_percentages.csv`, and `hf_api_handler.py` to interact with the HF API.
    * Outputs: `huggingface_naics_sector_models_database.csv`, `hf_naics_workflow.log`.
* **`dashboard_app.py`**:
    * The main Streamlit application script.
    * Loads processed data (`huggingface_naics_sector_models_database.csv`) and NAICS/CNI/keyword info (`naics_cni_percentages.csv`).
    * Uses functions from `config_utils.py` and `data_processing.py` for loading, caching, and analysis.
    * Displays interactive charts, tables, and summaries related to AI models per NAICS sector.
* **`config_utils.py`**:
    * Contains shared configuration variables (file paths, API settings), logging setup, and basic utility functions (`parse_list_string`) used by the dashboard workflow scripts.
* **`hf_api_handler.py`**:
    * Contains functions specifically for querying the Hugging Face Hub API (`list_models`, `whoami`) to find models based on keywords. Used by `run_data_collection.py`.
* **`data_processing.py`**:
    * Contains functions for loading NAICS/CNI/keyword data (`load_naics_keywords`), loading and preprocessing the collected Hugging Face model data (`load_and_preprocess_data`), and calculating various summaries (sector stats, keyword stats, top tasks). Used by `run_data_collection.py` and `dashboard_app.py`.
* **`model_completions.py`**:
    * (Assumed Purpose) A helper module likely containing functions (`process_df_prompts`) to interact with Large Language Models (like Anthropic's Claude or OpenAI's GPT models) for tasks such as the CNI classification performed in `Industry_mapping_spheres_CNI.py`. Requires appropriate API keys and library installations (e.g., `anthropic`, `openai`).

**Data Files (Input):**

* **`2-6 digit_2022_Codes.xlsx`**: Input file containing the official 2022 NAICS codes and titles. Used by `Industry_mapping_spheres_CNI.py`.

**Data Files (Output / Intermediate):**

* **`naics_cni_percentages.csv`**:
    * **Output** from `Industry_mapping_spheres_CNI.py`. Contains 2-digit NAICS sectors, their names, the calculated CNI percentage, and extracted keywords.
    * **Input** for `run_data_collection.py` (keywords) and `dashboard_app.py` (keywords, CNI %).
* **`naics_cni_classification_raw.csv`**: Output from `Industry_mapping_spheres_CNI.py`. Contains the raw LLM responses for the CNI classification task for each 4-digit subsector.
* **`naics_cni_classification_complete.csv`**: Output from `Industry_mapping_spheres_CNI.py`. Contains the 4-digit subsector details along with the parsed CNI classification (Yes/No flag) and the identified CNI sector name (if applicable).
* **`huggingface_naics_sector_models_database.csv`**: Output from `run_data_collection.py`. Contains the detailed information about Hugging Face models found matching the keywords, including metadata, downloads, likes, matched sectors/keywords etc. This is the primary input for `dashboard_app.py`.

**Output Files (Other):**

* **`naics_cni_percentages.png`**: Output visualization (bar chart) from `Industry_mapping_spheres_CNI.py`, showing CNI percentages per sector.
* **`hf_naics_workflow.log`**: Log file generated by the dashboard workflow scripts (`run_data_collection.py`, `dashboard_app.py`, etc.), recording execution steps, warnings, and errors.

**Documentation:**

* **`README.md`**: This file, providing an overview of the project.

## Setup & Dependencies

1.  **Python:** Ensure you have Python installed (tested with Python 3.9+).
2.  **Dependencies:** Install required Python libraries. You can typically do this using pip:
    ```bash
    pip install pandas openpyxl tqdm requests huggingface_hub streamlit plotly matplotlib wordcloud nltk anthropic openai
    ```
    *Note: `anthropic` and `openai` are needed if running the LLM classification in `Industry_mapping_spheres_CNI.py` via `model_completions.py`.*
3.  **NLTK Data:** The `Industry_mapping_spheres_CNI.py` script requires NLTK stopwords. It should download them automatically on the first run if missing.
4.  **Input Files:** Make sure the `2-6 digit_2022_Codes.xlsx` file is present in the project directory.

## Workflow / Usage

The typical workflow involves two main stages:

**Stage 1: NAICS CNI Classification & Keyword Generation**

1.  **Run Classification (Optional but Recommended):** Execute `Industry_mapping_spheres_CNI.py` to classify NAICS subsectors using an LLM and extract keywords.
    ```bash
    python Industry_mapping_spheres_CNI.py
    ```
    * This generates `naics_cni_classification_raw.csv`, `naics_cni_classification_complete.csv`, and importantly, `naics_cni_percentages.csv` which is needed for the next stage. It also produces `naics_cni_percentages.png`.
    * You can skip the LLM call (Step 5a) if you already have `naics_cni_classification_raw.csv` and proceed from Step 5b within the script.
2.  **Review Output:** Check the generated CSV files, especially `naics_cni_percentages.csv`, to ensure the CNI classifications and keywords seem reasonable.

**Stage 2: Hugging Face Model Analysis & Dashboard**

1.  **Collect Hugging Face Data:** Run the data collection script. This uses the keywords from `naics_cni_percentages.csv` to query Hugging Face.
    ```bash
    python run_data_collection.py
    ```
    * This generates/updates `huggingface_naics_sector_models_database.csv` and `hf_naics_workflow.log`. This step can take some time depending on the number of keywords and API rate limits.
2.  **Launch Dashboard:** Start the Streamlit application to view the results.
    ```bash
    streamlit run dashboard_app.py
    ```
    * This will open the interactive dashboard in your web browser, loading data from `huggingface_naics_sector_models_database.csv` and `naics_cni_percentages.csv`.

## Notes

* The CNI classification relies on the LLM's interpretation based on the provided CISA definitions and may require expert validation.
* The Hugging Face analysis uses keyword matching on model tags, which is a proxy for sector relevance and doesn't guarantee the model's primary use case.
* Ensure all scripts and required data files are in the same directory or adjust file paths within the scripts accordingly.